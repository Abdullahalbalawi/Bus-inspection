<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>نموذج فحص حافلة</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Cairo', system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
      font-weight: 600;
    }

    /* Damage marker (screen) */
    .damage-marker-print {
      position: absolute;
      font-size: 14px;
      line-height: 1;
      color: #dc2626;
      font-weight: 700;
      pointer-events: none;
    }

    @media print {
      @page {
        size: A4 portrait;
        margin: 5mm 8mm;
      }
      html, body {
        height: auto;
        min-height: 100%;
        overflow: visible !important;
        background-color: white !important;
        color: black !important;
      }
      body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        margin: 0;
        padding: 0;
        width: 100%;
        zoom: 0.8;
      }
      #root {
        width: 100%;
      }
      .no-print {
        display: none !important;
      }
      table {
        width: 100% !important;
        border-collapse: collapse;
        table-layout: fixed;
        border: 1px solid #000 !important;
      }
      th, td {
        border: 1px solid #000 !important;
        padding: 3px 5px !important;
        font-size: 11px !important;
        line-height: 1.2 !important;
        vertical-align: middle;
      }
      th {
        background-color: #f3f4f6 !important;
        font-weight: 700 !important;
      }
      .print-header {
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        align-items: center !important;
        border-bottom: 2px solid black !important;
        margin-bottom: 14px !important;
        padding-top: 10px !important;
        padding-bottom: 10px !important;
        position: relative !important;
      }
      .print-title {
        font-size: 22px !important;
        font-weight: 800 !important;
        text-decoration: underline !important;
        text-underline-offset: 6px !important;
      }
      input[type="checkbox"] {
        -webkit-appearance: none;
        appearance: none;
        width: 14px;
        height: 14px;
        border: 1.5px solid black !important;
        background-color: white !important;
      }
      input[type="checkbox"]:checked {
        background-color: black !important;
      }
      input[type="date"] {
        -webkit-appearance: none !important;
        appearance: none !important;
        background: transparent !important;
        border: none !important;
        color: #000 !important;
        font-size: inherit !important;
      }
      .damage-marker-print {
        font-size: 8px !important;
      }

      /* Keep signature blocks together on the same printed page */
      .print-sig-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
        gap: 0 !important;
        margin-top: 14px !important;
        break-inside: avoid;
        page-break-inside: avoid;
      }
      .print-sig-grid > div {
        break-inside: avoid;
        page-break-inside: avoid;
      }
      .print-sig-grid canvas {
        height: 60px !important;
        min-height: 60px !important;
        border: none !important;
      }

      /* Extra spacing under the role headers (name row area) */
      .print-sig-grid > div > .p-2 {
        padding-top: 12px !important;
        padding-right: 12px !important;
        padding-left: 12px !important;
      }
    }

    /* Custom Toast Notification */
    .toast-notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background-color: #333;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      z-index: 9999;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      font-weight: bold;
      text-align: center;
      min-width: 300px;
      pointer-events: none;
    }
    .toast-notification.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    .toast-notification.error {
      background-color: #dc2626;
      border-right: 6px solid #991b1b;
    }
    .toast-notification.success {
      background-color: #16a34a;
      border-right: 6px solid #14532d;
    }
    .toast-notification.info {
      background-color: #2563eb;
      border-right: 6px solid #1e3a8a;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <!-- المحتوى من new 1.txt -->
  <div id="root"><div class="min-h-screen bg-gray-50 pb-32 print:pb-0 print:bg-white font-sans text-right" dir="rtl"><div class="fixed top-0 left-0 right-0 z-40 bg-white/90 backdrop-blur-sm shadow-sm border-b border-gray-200 no-print transition-all"><div class="w-full max-w-7xl mx-auto px-4 py-2 flex items-center justify-between gap-4"><div class="flex items-center gap-2 text-sm font-bold text-gray-700"><span class="text-blue-600">نسبة الإنجاز</span><span class="">3%</span></div><div class="flex-1 h-2.5 bg-gray-200 rounded-full overflow-hidden"><div class="h-full transition-all duration-700 ease-out shadow-sm bg-blue-400" style="width: 3%;"></div></div></div></div><div class="pt-16 print:pt-0 form-wrapper print:w-full print:max-w-none"><div class="form-container card bg-white p-4 sm:p-6 lg:p-8 print:p-0 max-w-full"><div class="print-header brand-header flex flex-col md:flex-row justify-between items-center gap-4 mb-6 border-b-2 border-black pb-3"><div class="flex-1 flex justify-center md:justify-start print:justify-start"><img alt="Saptco Logo" class="h-14 md:h-16 lg:h-20 w-auto object-contain print:h-12 print:max-h-14 print:w-auto" src="https://i.suar.me/QXOPa/m"></div><div class="flex-1 text-center"><h1 class="text-2xl font-black print-title">نموذج فحص حافلة</h1></div><div class="flex-1 hidden md:block print:block"></div></div><div class="mb-6 print:mb-2 border border-black bg-black gap-px grid grid-cols-1 sm:grid-cols-2 print-grid-cols-2 rounded-sm overflow-hidden shadow-sm"><div class="flex bg-white items-stretch border-l border-black last:border-l-0 print:border-l print:border-b"><div class="w-28 sm:w-32 bg-gray-100 p-1.5 flex items-center justify-center border-l border-black text-center shrink-0 text-[11px] font-bold">رقم اللوحة</div><div class="flex-1 p-1 flex items-center min-w-0 relative"><input class="w-full bg-transparent outline-none text-center h-full px-2 text-[11px] font-medium font-bold " type="text" value=""></div></div><div class="flex bg-white items-stretch border-l border-black last:border-l-0 print:border-l print:border-b"><div class="w-28 sm:w-32 bg-gray-100 p-1.5 flex items-center justify-center border-l border-black text-center shrink-0 text-[11px] font-bold">التاريخ</div><div class="flex-1 p-1 flex items-center min-w-0 relative"><input class="w-full bg-transparent outline-none text-center h-full px-2 text-[11px] font-medium font-bold print:opacity-0" type="date" value="2025-12-27"><div class="hidden print:flex absolute inset-0 items-center justify-center pointer-events-none"><span class="text-[11px] font-medium font-bold w-full text-center">2025/12/27</span></div></div></div><div class="flex bg-white items-stretch border-l border-black last:border-l-0 print:border-l print:border-b"><div class="w-28 sm:w-32 bg-gray-100 p-1.5 flex items-center justify-center border-l border-black text-center shrink-0 text-[11px] font-bold">رقم التشغيل</div><div class="flex-1 p-1 flex items-center min-w-0 relative"><input class="w-full bg-transparent outline-none text-center h-full px-2 text-[11px] font-medium font-bold " type="text" value=""></div></div><div class="flex bg-white items-stretch border-l border-black last:border-l-0 print:border-l print:border-b"><div class="w-28 sm:w-32 bg-gray-100 p-1.5 flex items-center justify-center border-l border-black text-center shrink-0 text-[11px] font-bold">عدد المقاعد</div><div class="flex-1 p-1 flex items-center min-w-0 relative"><input class="w-full bg-transparent outline-none text-center h-full px-2 text-[11px] font-medium font-bold " type="text" value=""></div></div><div class="flex bg-white items-stretch border-l border-black last:border-l-0 print:border-l print:border-b"><div class="w-28 sm:w-32 bg-gray-100 p-1.5 flex items-center justify-center border-l border-black text-center shrink-0 text-[11px] font-bold">اسم المدرسة</div><div class="flex-1 p-1 flex items-center min-w-0 relative"><input class="w-full bg-transparent outline-none text-center h-full px-2 text-[11px] font-medium font-bold " type="text" value=""></div></div><div class="flex bg-white items-stretch border-l border-black last:border-l-0 print:border-l print:border-b"><div class="w-28 sm:w-32 bg-gray-100 p-1.5 flex items-center justify-center border-l border-black text-center shrink-0 text-[11px] font-bold">عدد الكيلومتر</div><div class="flex-1 p-1 flex items-center min-w-0 relative"><input class="w-full bg-transparent outline-none text-center h-full px-2 text-[11px] font-medium font-bold " type="text" value=""></div></div></div><div class="space-y-4 print:space-y-2"><div class="mb-4 print:mb-2 print:break-inside-avoid"><div class="hidden lg:block print:block overflow-x-auto print:overflow-visible"><table class="w-full min-w-[760px] print:min-w-0 border-collapse table-fixed" style="border-spacing: 0px; border: 1px solid rgb(0, 0, 0);"><thead><tr><th colspan="5" class="bg-gray-100 py-1.5 px-3 text-center text-base font-black" style="border: 1px solid rgb(0, 0, 0);">صيانة</th></tr><tr class="bg-gray-50 relative"><th class="p-1.5 text-center text-xs font-bold" style="width: 35%; border: 1px solid rgb(0, 0, 0);">البند</th><th class="p-1 leading-tight text-center text-[10px] font-normal font-bold" style="width: 7%; border: 1px solid rgb(0, 0, 0);">اجتياز</th><th class="p-1 leading-tight text-center text-[10px] font-normal font-bold" style="width: 7%; border: 1px solid rgb(0, 0, 0);">فشل</th><th class="p-1.5 text-center text-xs font-bold" style="width: 20%; border: 1px solid rgb(0, 0, 0);">التقييم</th><th class="p-1.5 text-center relative text-xs font-bold" style="width: 31%; border: 1px solid rgb(0, 0, 0);">ملاحظات عامة</th></tr></thead><tbody><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">الحالة الميكانيكية</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="ممتازة">ممتازة</option><option value="جيدة">جيدة</option><option value="متوسطة">متوسطة</option><option value="تحتاج صيانة">تحتاج صيانة</option><option value="متوقفة عن العمل">متوقفة عن العمل</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td><td rowspan="5" class="align-top bg-white p-0 relative " style="border: 1px solid rgb(0, 0, 0);"><div class="grid grid-cols-1 grid-rows-1 min-h-[100px] h-full"><textarea maxlength="500" class="col-start-1 row-start-1 w-full h-full p-2 leading-relaxed resize-none bg-transparent focus:outline-none overflow-hidden print:hidden text-[11px] font-medium" placeholder="ملاحظات..."></textarea><div class="hidden print:block col-start-1 row-start-1 p-1 leading-tight whitespace-pre-wrap break-words text-[10px] font-medium"></div></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">كهرباء الحافلة</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="سليمة">سليمة</option><option value="ملاحظة بسيطة">ملاحظة بسيطة</option><option value="عطل جزئي">عطل جزئي</option><option value="عطل كامل">عطل كامل</option><option value="تحتاج فحص فني">تحتاج فحص فني</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">البطاريات</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="جديدة">جديدة</option><option value="بحالة جيدة">بحالة جيدة</option><option value="ضعيفة">ضعيفة</option><option value="تحتاج شحن">تحتاج شحن</option><option value="تحتاج استبدال">تحتاج استبدال</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">الإطارات</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="جديدة">جديدة</option><option value="جيدة">جيدة</option><option value="متوسطة">متوسطة</option><option value="تالفة جزئياً">تالفة جزئياً</option><option value="تحتاج استبدال فوري">تحتاج استبدال فوري</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr><td class="px-2 py-1 font-bold bg-gray-100 text-center text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">التقييم النهائي</td><td colspan="3" class="px-1 text-center bg-gray-50 py-1 print:p-0" style="border: 1px solid rgb(0, 0, 0);"><input readonly="" class="percent-badge w-full bg-transparent text-center text-base font-black text-red-700 font-bold font-black" type="text" value="0%"></td></tr></tbody></table></div><div class="lg:hidden print:hidden rounded-lg overflow-hidden shadow-sm bg-white" style="border: 1px solid rgb(0, 0, 0);"><div class="bg-gray-100 py-3 px-4 text-center font-bold text-base font-black" style="border-bottom: 1px solid rgb(0, 0, 0);">صيانة</div><div class="divide-y" style="border-color: rgb(0, 0, 0);"><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">الحالة الميكانيكية</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="ممتازة">ممتازة</option><option value="جيدة">جيدة</option><option value="متوسطة">متوسطة</option><option value="تحتاج صيانة">تحتاج صيانة</option><option value="متوقفة عن العمل">متوقفة عن العمل</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">كهرباء الحافلة</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="سليمة">سليمة</option><option value="ملاحظة بسيطة">ملاحظة بسيطة</option><option value="عطل جزئي">عطل جزئي</option><option value="عطل كامل">عطل كامل</option><option value="تحتاج فحص فني">تحتاج فحص فني</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">البطاريات</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="جديدة">جديدة</option><option value="بحالة جيدة">بحالة جيدة</option><option value="ضعيفة">ضعيفة</option><option value="تحتاج شحن">تحتاج شحن</option><option value="تحتاج استبدال">تحتاج استبدال</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">الإطارات</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="جديدة">جديدة</option><option value="جيدة">جيدة</option><option value="متوسطة">متوسطة</option><option value="تالفة جزئياً">تالفة جزئياً</option><option value="تحتاج استبدال فوري">تحتاج استبدال فوري</option></select></div></div><div class="border-t p-4 bg-gray-50" style="border-color: rgb(0, 0, 0); border-width: 1px;"><label class="block text-sm font-bold mb-2 text-gray-700">ملاحظات عامة</label><textarea maxlength="500" rows="3" class="w-full p-3 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" placeholder="اكتب ملاحظاتك هنا..." style="border: 1px solid rgb(0, 0, 0);"></textarea></div></div></div><div class="mb-4 print:mb-2 print:break-inside-avoid"><div class="hidden lg:block print:block overflow-x-auto print:overflow-visible"><table class="w-full min-w-[760px] print:min-w-0 border-collapse table-fixed" style="border-spacing: 0px; border: 1px solid rgb(0, 0, 0);"><thead><tr><th colspan="5" class="bg-gray-100 py-1.5 px-3 text-center text-base font-black" style="border: 1px solid rgb(0, 0, 0);">حوادث وتأمين</th></tr><tr class="bg-gray-50 relative"><th class="p-1.5 text-center text-xs font-bold" style="width: 35%; border: 1px solid rgb(0, 0, 0);">البند</th><th class="p-1 leading-tight text-center text-[10px] font-normal font-bold" style="width: 7%; border: 1px solid rgb(0, 0, 0);">اجتياز</th><th class="p-1 leading-tight text-center text-[10px] font-normal font-bold" style="width: 7%; border: 1px solid rgb(0, 0, 0);">فشل</th><th class="p-1.5 text-center text-xs font-bold" style="width: 20%; border: 1px solid rgb(0, 0, 0);">التقييم</th><th class="p-1.5 text-center relative text-xs font-bold" style="width: 31%; border: 1px solid rgb(0, 0, 0);">مخطط الحافلة</th></tr></thead><tbody><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">الهيكل الخارجي</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="سليم">سليم</option><option value="خدوش بسيطة">خدوش بسيطة</option><option value="أضرار متوسطة">أضرار متوسطة</option><option value="أضرار جسيمة">أضرار جسيمة</option><option value="يحتاج إصلاح عاجل">يحتاج إصلاح عاجل</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td><td rowspan="5" class="align-top bg-white p-0 relative " style="border: 1px solid rgb(0, 0, 0);"><div class="w-full h-full flex flex-col items-center justify-center p-2 bg-white print:p-1"><div class="relative inline-block cursor-zoom-in group print:w-full print:flex print:justify-center" title="انقر للتكبير؛ أضف العلامات داخل وضع التكبير"><img alt="Diagram" class="max-w-full max-h-[180px] print:max-h-[110px] object-contain block select-none" draggable="false" src="https://i.suar.me/MzlMz/m"></div></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">الزجاج</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="سليم">سليم</option><option value="شرخ بسيط">شرخ بسيط</option><option value="كسر جزئي">كسر جزئي</option><option value="كسر كامل">كسر كامل</option><option value="يحتاج استبدال">يحتاج استبدال</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">علامة قف</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="موجودة وتعمل">موجودة وتعمل</option><option value="موجودة ولا تعمل">موجودة ولا تعمل</option><option value="تالفة">تالفة</option><option value="غير موجودة">غير موجودة</option><option value="تحتاج صيانة">تحتاج صيانة</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">ذراع الأمان</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="يعمل بكفاءة">يعمل بكفاءة</option><option value="يعمل جزئياً">يعمل جزئياً</option><option value="لا يعمل">لا يعمل</option><option value="تالف">تالف</option><option value="غير موجود">غير موجود</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr><td class="px-2 py-1 font-bold bg-gray-100 text-center text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">التقييم النهائي</td><td colspan="3" class="px-1 text-center bg-gray-50 py-1 print:p-0" style="border: 1px solid rgb(0, 0, 0);"><input readonly="" class="percent-badge w-full bg-transparent text-center text-base font-black text-red-700 font-bold font-black" type="text" value="0%"></td></tr></tbody></table></div><div class="lg:hidden print:hidden rounded-lg overflow-hidden shadow-sm bg-white" style="border: 1px solid rgb(0, 0, 0);"><div class="bg-gray-100 py-3 px-4 text-center font-bold text-base font-black" style="border-bottom: 1px solid rgb(0, 0, 0);">حوادث وتأمين</div><div class="divide-y" style="border-color: rgb(0, 0, 0);"><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">الهيكل الخارجي</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="سليم">سليم</option><option value="خدوش بسيطة">خدوش بسيطة</option><option value="أضرار متوسطة">أضرار متوسطة</option><option value="أضرار جسيمة">أضرار جسيمة</option><option value="يحتاج إصلاح عاجل">يحتاج إصلاح عاجل</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">الزجاج</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="سليم">سليم</option><option value="شرخ بسيط">شرخ بسيط</option><option value="كسر جزئي">كسر جزئي</option><option value="كسر كامل">كسر كامل</option><option value="يحتاج استبدال">يحتاج استبدال</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">علامة قف</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="موجودة وتعمل">موجودة وتعمل</option><option value="موجودة ولا تعمل">موجودة ولا تعمل</option><option value="تالفة">تالفة</option><option value="غير موجودة">غير موجودة</option><option value="تحتاج صيانة">تحتاج صيانة</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">ذراع الأمان</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="يعمل بكفاءة">يعمل بكفاءة</option><option value="يعمل جزئياً">يعمل جزئياً</option><option value="لا يعمل">لا يعمل</option><option value="تالف">تالف</option><option value="غير موجود">غير موجود</option></select></div></div><div class="border-t p-4 bg-gray-50" style="border-color: rgb(0, 0, 0); border-width: 1px;"><label class="block text-sm font-bold mb-2 text-gray-700">مخطط الحافلة</label><div class="w-full p-2 rounded-lg bg-gray-50 flex flex-col items-center min-h-[150px]" style="border: 1px solid rgb(0, 0, 0);"><div class="relative inline-block"><img alt="Diagram" class="max-w-full h-auto max-h-[250px] object-contain block select-none" draggable="false" src="https://i.suar.me/MzlMz/m"></div></div></div></div></div><div class="mb-4 print:mb-2 print:break-inside-avoid"><div class="hidden lg:block print:block overflow-x-auto print:overflow-visible"><table class="w-full min-w-[760px] print:min-w-0 border-collapse table-fixed" style="border-spacing: 0px; border: 1px solid rgb(0, 0, 0);"><thead><tr><th colspan="5" class="bg-gray-100 py-1.5 px-3 text-center text-base font-black" style="border: 1px solid rgb(0, 0, 0);">الأسطول</th></tr><tr class="bg-gray-50 relative"><th class="p-1.5 text-center text-xs font-bold" style="width: 35%; border: 1px solid rgb(0, 0, 0);">البند</th><th class="p-1 leading-tight text-center text-[10px] font-normal font-bold" style="width: 7%; border: 1px solid rgb(0, 0, 0);">اجتياز</th><th class="p-1 leading-tight text-center text-[10px] font-normal font-bold" style="width: 7%; border: 1px solid rgb(0, 0, 0);">فشل</th><th class="p-1.5 text-center text-xs font-bold" style="width: 20%; border: 1px solid rgb(0, 0, 0);">التقييم</th><th class="p-1.5 text-center relative text-xs font-bold" style="width: 31%; border: 1px solid rgb(0, 0, 0);">ملاحظات عامة</th></tr></thead><tbody><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">الأوراق الثبوتية</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="مكتملة وسارية">مكتملة وسارية</option><option value="مكتملة وقريبة الانتهاء">مكتملة وقريبة الانتهاء</option><option value="ناقصة">ناقصة</option><option value="منتهية الصلاحية">منتهية الصلاحية</option><option value="تحتاج تحديث">تحتاج تحديث</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td><td rowspan="7" class="align-top bg-white p-0 relative " style="border: 1px solid rgb(0, 0, 0);"><div class="grid grid-cols-1 grid-rows-1 min-h-[100px] h-full"><textarea maxlength="500" class="col-start-1 row-start-1 w-full h-full p-2 leading-relaxed resize-none bg-transparent focus:outline-none overflow-hidden print:hidden text-[11px] font-medium" placeholder="ملاحظات..."></textarea><div class="hidden print:block col-start-1 row-start-1 p-1 leading-tight whitespace-pre-wrap break-words text-[10px] font-medium"></div></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">الملصقات</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="موجودة وواضحة">موجودة وواضحة</option><option value="موجودة وباهتة">موجودة وباهتة</option><option value="تالفة">تالفة</option><option value="ناقصة">ناقصة</option><option value="غير موجودة">غير موجودة</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">الديكور والمقاعد</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="نظيفة وسليمة">نظيفة وسليمة</option><option value="مقبولة">مقبولة</option><option value="تحتاج تنظيف">تحتاج تنظيف</option><option value="تالفة جزئياً">تالفة جزئياً</option><option value="تالفة وتحتاج إصلاح">تالفة وتحتاج إصلاح</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">شرائح الديزل</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="سليمة">سليمة</option><option value="فعالة جزئياً">فعالة جزئياً</option><option value="لا تعمل">لا تعمل</option><option value="تحتاج إعادة برمجة">تحتاج إعادة برمجة</option><option value="تحتاج استبدال">تحتاج استبدال</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">أدوات الأمن والسلامة</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="مكتملة وسليمة">مكتملة وسليمة</option><option value="مكتملة مع ملاحظات">مكتملة مع ملاحظات</option><option value="ناقصة">ناقصة</option><option value="تالفة">تالفة</option><option value="غير موجودة">غير موجودة</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">زر الأمان</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="يعمل">يعمل</option><option value="يعمل أحياناً">يعمل أحياناً</option><option value="لا يعمل">لا يعمل</option><option value="تالف">تالف</option><option value="غير موجود">غير موجود</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr><td class="px-2 py-1 font-bold bg-gray-100 text-center text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">التقييم النهائي</td><td colspan="3" class="px-1 text-center bg-gray-50 py-1 print:p-0" style="border: 1px solid rgb(0, 0, 0);"><input readonly="" class="percent-badge w-full bg-transparent text-center text-base font-black text-red-700 font-bold font-black" type="text" value="0%"></td></tr></tbody></table></div><div class="lg:hidden print:hidden rounded-lg overflow-hidden shadow-sm bg-white" style="border: 1px solid rgb(0, 0, 0);"><div class="bg-gray-100 py-3 px-4 text-center font-bold text-base font-black" style="border-bottom: 1px solid rgb(0, 0, 0);">الأسطول</div><div class="divide-y" style="border-color: rgb(0, 0, 0);"><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">الأوراق الثبوتية</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="مكتملة وسارية">مكتملة وسارية</option><option value="مكتملة وقريبة الانتهاء">مكتملة وقريبة الانتهاء</option><option value="ناقصة">ناقصة</option><option value="منتهية الصلاحية">منتهية الصلاحية</option><option value="تحتاج تحديث">تحتاج تحديث</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">الملصقات</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="موجودة وواضحة">موجودة وواضحة</option><option value="موجودة وباهتة">موجودة وباهتة</option><option value="تالفة">تالفة</option><option value="ناقصة">ناقصة</option><option value="غير موجودة">غير موجودة</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">الديكور والمقاعد</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="نظيفة وسليمة">نظيفة وسليمة</option><option value="مقبولة">مقبولة</option><option value="تحتاج تنظيف">تحتاج تنظيف</option><option value="تالفة جزئياً">تالفة جزئياً</option><option value="تالفة وتحتاج إصلاح">تالفة وتحتاج إصلاح</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">شرائح الديزل</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="سليمة">سليمة</option><option value="فعالة جزئياً">فعالة جزئياً</option><option value="لا تعمل">لا تعمل</option><option value="تحتاج إعادة برمجة">تحتاج إعادة برمجة</option><option value="تحتاج استبدال">تحتاج استبدال</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">أدوات الأمن والسلامة</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="مكتملة وسليمة">مكتملة وسليمة</option><option value="مكتملة مع ملاحظات">مكتملة مع ملاحظات</option><option value="ناقصة">ناقصة</option><option value="تالفة">تالفة</option><option value="غير موجودة">غير موجودة</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">زر الأمان</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="يعمل">يعمل</option><option value="يعمل أحياناً">يعمل أحياناً</option><option value="لا يعمل">لا يعمل</option><option value="تالف">تالف</option><option value="غير موجود">غير موجود</option></select></div></div><div class="border-t p-4 bg-gray-50" style="border-color: rgb(0, 0, 0); border-width: 1px;"><label class="block text-sm font-bold mb-2 text-gray-700">ملاحظات عامة</label><textarea maxlength="500" rows="3" class="w-full p-3 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" placeholder="اكتب ملاحظاتك هنا..." style="border: 1px solid rgb(0, 0, 0);"></textarea></div></div></div><div class="mb-4 print:mb-2 print:break-inside-avoid"><div class="hidden lg:block print:block overflow-x-auto print:overflow-visible"><table class="w-full min-w-[760px] print:min-w-0 border-collapse table-fixed" style="border-spacing: 0px; border: 1px solid rgb(0, 0, 0);"><thead><tr><th colspan="5" class="bg-gray-100 py-1.5 px-3 text-center text-base font-black" style="border: 1px solid rgb(0, 0, 0);">السائق</th></tr><tr class="bg-gray-50 relative"><th class="p-1.5 text-center text-xs font-bold" style="width: 35%; border: 1px solid rgb(0, 0, 0);">البند</th><th class="p-1 leading-tight text-center text-[10px] font-normal font-bold" style="width: 7%; border: 1px solid rgb(0, 0, 0);">اجتياز</th><th class="p-1 leading-tight text-center text-[10px] font-normal font-bold" style="width: 7%; border: 1px solid rgb(0, 0, 0);">فشل</th><th class="p-1.5 text-center text-xs font-bold" style="width: 20%; border: 1px solid rgb(0, 0, 0);">التقييم</th><th class="p-1.5 text-center relative text-xs font-bold" style="width: 31%; border: 1px solid rgb(0, 0, 0);">ملاحظات عامة</th></tr></thead><tbody><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">الالتزام بمواعيد الدوام</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="ملتزم تماماً">ملتزم تماماً</option><option value="ملتزم غالباً">ملتزم غالباً</option><option value="تأخير بسيط">تأخير بسيط</option><option value="تأخير متكرر">تأخير متكرر</option><option value="غير ملتزم">غير ملتزم</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td><td rowspan="8" class="align-top bg-white p-0 relative " style="border: 1px solid rgb(0, 0, 0);"><div class="grid grid-cols-1 grid-rows-1 min-h-[100px] h-full"><textarea maxlength="500" class="col-start-1 row-start-1 w-full h-full p-2 leading-relaxed resize-none bg-transparent focus:outline-none overflow-hidden print:hidden text-[11px] font-medium" placeholder="ملاحظات..."></textarea><div class="hidden print:block col-start-1 row-start-1 p-1 leading-tight whitespace-pre-wrap break-words text-[10px] font-medium"></div></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">المظهر الشخصي</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="لائق ومطابق للتعليمات">لائق ومطابق للتعليمات</option><option value="مقبول">مقبول</option><option value="يحتاج تنبيه">يحتاج تنبيه</option><option value="غير لائق">غير لائق</option><option value="مخالف للتعليمات">مخالف للتعليمات</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">التعامل مع مراقبي التشغيل</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="ممتاز">ممتاز</option><option value="جيد">جيد</option><option value="مقبول">مقبول</option><option value="ضعيف">ضعيف</option><option value="غير متعاون">غير متعاون</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">الالتزام بالتعليمات الصادرة</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="ملتزم">ملتزم</option><option value="ملتزم مع ملاحظات">ملتزم مع ملاحظات</option><option value="مخالف أحياناً">مخالف أحياناً</option><option value="مخالف باستمرار">مخالف باستمرار</option><option value="غير ملتزم">غير ملتزم</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">المحافظة على نظافة الحافلة</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="ممتازة">ممتازة</option><option value="جيدة">جيدة</option><option value="مقبولة">مقبولة</option><option value="سيئة">سيئة</option><option value="مهملة">مهملة</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">المواظبة على الفحص النظري</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="مواظب">مواظب</option><option value="مواظب غالباً">مواظب غالباً</option><option value="غير منتظم">غير منتظم</option><option value="نادراً">نادراً</option><option value="لا يقوم بالفحص">لا يقوم بالفحص</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr class="hover:bg-gray-50/50"><td class="px-2 py-1 whitespace-normal break-words text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">الإبلاغ عن الأعطال ومتابعتها</td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="text-center align-middle py-1" style="border: 1px solid rgb(0, 0, 0);"><input class="w-4 h-4 cursor-pointer" type="checkbox"></td><td class="px-1 text-center relative h-full bg-white" style="border: 1px solid rgb(0, 0, 0);"><select class="w-full h-full bg-transparent focus:outline-none text-center appearance-none print:hidden cursor-pointer py-1 text-[11px] font-medium font-bold"><option value="">-- اختر --</option><option value="يبلغ ويتابع">يبلغ ويتابع</option><option value="يبلغ فقط">يبلغ فقط</option><option value="يتأخر في الإبلاغ">يتأخر في الإبلاغ</option><option value="لا يتابع">لا يتابع</option><option value="لا يبلغ عن الأعطال">لا يبلغ عن الأعطال</option></select><div class="hidden print:block text-center text-[10px] font-bold"></div></td></tr><tr><td class="px-2 py-1 font-bold bg-gray-100 text-center text-[11px] font-bold" style="border: 1px solid rgb(0, 0, 0);">التقييم النهائي</td><td colspan="3" class="px-1 text-center bg-gray-50 py-1 print:p-0" style="border: 1px solid rgb(0, 0, 0);"><input readonly="" class="percent-badge w-full bg-transparent text-center text-base font-black text-red-700 font-bold font-black" type="text" value="0%"></td></tr></tbody></table></div><div class="lg:hidden print:hidden rounded-lg overflow-hidden shadow-sm bg-white" style="border: 1px solid rgb(0, 0, 0);"><div class="bg-gray-100 py-3 px-4 text-center font-bold text-base font-black" style="border-bottom: 1px solid rgb(0, 0, 0);">السائق</div><div class="divide-y" style="border-color: rgb(0, 0, 0);"><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">الالتزام بمواعيد الدوام</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="ملتزم تماماً">ملتزم تماماً</option><option value="ملتزم غالباً">ملتزم غالباً</option><option value="تأخير بسيط">تأخير بسيط</option><option value="تأخير متكرر">تأخير متكرر</option><option value="غير ملتزم">غير ملتزم</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">المظهر الشخصي</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="لائق ومطابق للتعليمات">لائق ومطابق للتعليمات</option><option value="مقبول">مقبول</option><option value="يحتاج تنبيه">يحتاج تنبيه</option><option value="غير لائق">غير لائق</option><option value="مخالف للتعليمات">مخالف للتعليمات</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">التعامل مع مراقبي التشغيل</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="ممتاز">ممتاز</option><option value="جيد">جيد</option><option value="مقبول">مقبول</option><option value="ضعيف">ضعيف</option><option value="غير متعاون">غير متعاون</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">الالتزام بالتعليمات الصادرة</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="ملتزم">ملتزم</option><option value="ملتزم مع ملاحظات">ملتزم مع ملاحظات</option><option value="مخالف أحياناً">مخالف أحياناً</option><option value="مخالف باستمرار">مخالف باستمرار</option><option value="غير ملتزم">غير ملتزم</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">المحافظة على نظافة الحافلة</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="ممتازة">ممتازة</option><option value="جيدة">جيدة</option><option value="مقبولة">مقبولة</option><option value="سيئة">سيئة</option><option value="مهملة">مهملة</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">المواظبة على الفحص النظري</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="مواظب">مواظب</option><option value="مواظب غالباً">مواظب غالباً</option><option value="غير منتظم">غير منتظم</option><option value="نادراً">نادراً</option><option value="لا يقوم بالفحص">لا يقوم بالفحص</option></select></div><div class="p-4 flex flex-col gap-3"><div class="font-medium text-[11px] font-bold">الإبلاغ عن الأعطال ومتابعتها</div><div class="flex items-center gap-4"><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-blue-600" type="checkbox"><span class="text-sm font-bold text-gray-600">اجتياز</span></label><label class="flex items-center gap-2 cursor-pointer p-2 rounded bg-gray-50 flex-1 justify-center " style="border: 1px solid rgb(0, 0, 0);"><input class="w-5 h-5 accent-red-600" type="checkbox"><span class="text-sm font-bold text-gray-600">فشل</span></label></div><select class="w-full p-2 rounded bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" style="border: 1px solid rgb(0, 0, 0);"><option value="">-- اختر التقييم --</option><option value="يبلغ ويتابع">يبلغ ويتابع</option><option value="يبلغ فقط">يبلغ فقط</option><option value="يتأخر في الإبلاغ">يتأخر في الإبلاغ</option><option value="لا يتابع">لا يتابع</option><option value="لا يبلغ عن الأعطال">لا يبلغ عن الأعطال</option></select></div></div><div class="border-t p-4 bg-gray-50" style="border-color: rgb(0, 0, 0); border-width: 1px;"><label class="block text-sm font-bold mb-2 text-gray-700">ملاحظات عامة</label><textarea maxlength="500" rows="3" class="w-full p-3 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-[11px] font-medium" placeholder="اكتب ملاحظاتك هنا..." style="border: 1px solid rgb(0, 0, 0);"></textarea></div></div></div></div><div class="mt-8 print:mt-2"><div class="print-sig-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 print:gap-0 border-t-2 border-black pt-4 print:pt-0 print:border-t-0"><div class="border border-black flex flex-col bg-white print:border-0 print:rounded-none"><div class="bg-gray-100 font-black p-1.5 border-b border-black print:border-b-0 text-center text-base font-black">السائق</div><div class="p-2 space-y-2 print:space-y-1 print:p-1 flex-1 flex flex-col"><div class="flex items-center gap-1"><span class="font-bold shrink-0 text-[11px] font-bold">الاسم:</span><input class="flex-1 border-b border-gray-400 focus:border-blue-500 px-1 py-0.5 font-bold text-[11px] font-medium" type="text" value=""></div><div class="flex-1 flex flex-col"><span class="font-bold mb-1 text-[11px] font-bold">التوقيع:</span><div class="flex flex-col gap-1"><canvas width="240" height="80" class="w-full border border-black bg-white cursor-pointer hover:bg-gray-50 transition-colors print:border-black print:rounded-none print:cursor-default" title="انقر هنا للتوقيع" style="display: block; min-height: 80px; touch-action: none;"></canvas><div class="flex gap-1 justify-center print:hidden"><button class="text-xs px-2 py-0.5 bg-red-100 hover:bg-red-200 text-red-700 rounded transition-colors border border-red-300 cursor-pointer">حذف التوقيع</button></div></div></div><div class="flex items-center gap-1 relative"><span class="font-bold shrink-0 text-[11px] font-bold">التاريخ:</span><input class="flex-1 border-b border-gray-400 focus:border-blue-500 px-1 py-0.5 font-bold text-[11px] font-medium print:opacity-0" type="date" value=""><div class="hidden print:flex absolute inset-0 items-center justify-center pointer-events-none"><span class="text-[11px] font-medium font-bold w-full text-center"></span></div></div></div></div><div class="border border-black flex flex-col bg-white print:border-0 print:rounded-none"><div class="bg-gray-100 font-black p-1.5 border-b border-black print:border-b-0 text-center text-base font-black">مراقب التشغيل</div><div class="p-2 space-y-2 print:space-y-1 print:p-1 flex-1 flex flex-col"><div class="flex items-center gap-1"><span class="font-bold shrink-0 text-[11px] font-bold">الاسم:</span><input class="flex-1 border-b border-gray-400 focus:border-blue-500 px-1 py-0.5 font-bold text-[11px] font-medium" type="text" value=""></div><div class="flex-1 flex flex-col"><span class="font-bold mb-1 text-[11px] font-bold">التوقيع:</span><div class="flex flex-col gap-1"><canvas width="240" height="80" class="w-full border border-black bg-white cursor-pointer hover:bg-gray-50 transition-colors print:border-black print:rounded-none print:cursor-default" title="انقر هنا للتوقيع" style="display: block; min-height: 80px; touch-action: none;"></canvas><div class="flex gap-1 justify-center print:hidden"><button class="text-xs px-2 py-0.5 bg-red-100 hover:bg-red-200 text-red-700 rounded transition-colors border border-red-300 cursor-pointer">حذف التوقيع</button></div></div></div><div class="flex items-center gap-1 relative"><span class="font-bold shrink-0 text-[11px] font-bold">التاريخ:</span><input class="flex-1 border-b border-gray-400 focus:border-blue-500 px-1 py-0.5 font-bold text-[11px] font-medium print:opacity-0" type="date" value=""><div class="hidden print:flex absolute inset-0 items-center justify-center pointer-events-none"><span class="text-[11px] font-medium font-bold w-full text-center"></span></div></div></div></div><div class="border border-black flex flex-col bg-white print:border-0 print:rounded-none"><div class="bg-gray-100 font-black p-1.5 border-b border-black print:border-b-0 text-center text-base font-black">مشرف التشغيل</div><div class="p-2 space-y-2 print:space-y-1 print:p-1 flex-1 flex flex-col"><div class="flex items-center gap-1"><span class="font-bold shrink-0 text-[11px] font-bold">الاسم:</span><input class="flex-1 border-b border-gray-400 focus:border-blue-500 px-1 py-0.5 font-bold text-[11px] font-medium" type="text" value=""></div><div class="flex-1 flex flex-col"><span class="font-bold mb-1 text-[11px] font-bold">التوقيع:</span><div class="flex flex-col gap-1"><canvas width="240" height="80" class="w-full border border-black bg-white cursor-pointer hover:bg-gray-50 transition-colors print:border-black print:rounded-none print:cursor-default" title="انقر هنا للتوقيع" style="display: block; min-height: 80px; touch-action: none;"></canvas><div class="flex gap-1 justify-center print:hidden"><button class="text-xs px-2 py-0.5 bg-red-100 hover:bg-red-200 text-red-700 rounded transition-colors border border-red-300 cursor-pointer">حذف التوقيع</button></div></div></div><div class="flex items-center gap-1 relative"><span class="font-bold shrink-0 text-[11px] font-bold">التاريخ:</span><input class="flex-1 border-b border-gray-400 focus:border-blue-500 px-1 py-0.5 font-bold text-[11px] font-medium print:opacity-0" type="date" value=""><div class="hidden print:flex absolute inset-0 items-center justify-center pointer-events-none"><span class="text-[11px] font-medium font-bold w-full text-center"></span></div></div></div></div></div></div></div></div><div class="fixed bottom-4 left-1/2 -translate-x-1/2 flex flex-row gap-3 z-50 no-print"><button type="button" class="flex items-center gap-2 bg-teal-600 hover:bg-teal-700 text-white py-3 px-4 rounded-lg shadow-lg transition-all hover:-translate-y-1 cursor-pointer active:scale-95" title="طباعة"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-printer"><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><path d="M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6"></path><rect x="6" y="14" width="12" height="8" rx="1"></rect></svg><span class="font-bold hidden md:inline">طباعة</span></button><button type="button" class="flex items-center gap-2 bg-teal-700 hover:bg-teal-800 text-white py-3 px-4 rounded-lg shadow-lg transition-all hover:-translate-y-1 cursor-pointer active:scale-95" title="تصدير PDF"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-down"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M12 18v-6"></path><path d="m9 15 3 3 3-3"></path></svg><span class="font-bold hidden md:inline">PDF</span></button><button type="button" class="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg shadow-lg transition-all hover:-translate-y-1 cursor-pointer active:scale-95" title="بيانات تجريبية"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M10 9H8"></path><path d="M16 13H8"></path><path d="M16 17H8"></path></svg><span class="font-bold hidden md:inline">بيانات</span></button><button type="button" class="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg shadow-lg transition-all hover:-translate-y-1 cursor-pointer active:scale-95" title="مسح"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg><span class="font-bold hidden md:inline">مسح</span></button></div></div></div>
  </div>

  <!-- Modal للتكبير -->
  <div id="busDiagramModal" class="fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 hidden no-print">
    <div class="relative bg-white rounded-lg overflow-hidden max-w-full max-h-full">
      <button id="closeModalBtn" class="absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center z-10">✕</button>
      <div id="diagramContainer" class="relative cursor-crosshair overflow-auto max-h-[80vh]">
        <img id="modalDiagramImg" src="https://i.suar.me/MzlMz/m" class="block max-w-full" />
      </div>
    </div>
  </div>

  <!-- Modal شاشة التوقيع -->
  <div id="signatureModal" class="fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 hidden no-print">
    <div class="relative bg-white rounded-lg overflow-hidden w-full max-w-3xl">
      <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
        <div class="font-black">التوقيع</div>
        <button id="signatureCloseBtn" type="button" class="bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center">✕</button>
      </div>
      <div class="p-4">
        <canvas id="signatureModalCanvas" class="w-full h-[60vh] max-h-[420px] border border-black bg-white block" style="touch-action: none;"></canvas>
        <div class="flex items-center justify-center gap-2 mt-4">
          <button id="signatureClearBtn" type="button" class="text-sm px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded border border-red-300 cursor-pointer">مسح</button>
          <button id="signatureSaveBtn" type="button" class="text-sm px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded cursor-pointer">حفظ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize jsPDF
    window.jsPDF = window.jspdf.jsPDF;

    document.addEventListener('DOMContentLoaded', function () {
      // DOM Elements
      const printBtn = document.querySelector('button[title="طباعة"]');
      const pdfBtn = document.querySelector('button[title="تصدير PDF"]');
      const dataBtn = document.querySelector('button[title="بيانات تجريبية"]');
      const clearBtn = document.querySelector('button[title="مسح"]');
      const modal = document.getElementById('busDiagramModal');
      const modalImg = document.getElementById('modalDiagramImg');
      const diagramContainer = document.getElementById('diagramContainer');
      const closeModalBtn = document.getElementById('closeModalBtn');

      // Button Events
      if (printBtn) printBtn.addEventListener('click', () => window.print());
      if (pdfBtn) pdfBtn.addEventListener('click', exportToPDF);
      if (dataBtn) dataBtn.addEventListener('click', fillTestData);
      if (clearBtn) clearBtn.addEventListener('click', clearForm);

      // Signature Screen (open on click)
      const signatureModal = document.getElementById('signatureModal');
      const signatureModalCanvas = document.getElementById('signatureModalCanvas');
      const signatureCloseBtn = document.getElementById('signatureCloseBtn');
      const signatureClearBtn = document.getElementById('signatureClearBtn');
      const signatureSaveBtn = document.getElementById('signatureSaveBtn');

      const SIGNATURE_LINE_WIDTH = 3.5;
      // Increase resolution scale to 3x for ultra-sharp rendering
      const CANVAS_SCALE = Math.max(window.devicePixelRatio || 1, 3);

      const signatureBoxes = Array.from(document.querySelectorAll('canvas[title="انقر هنا للتوقيع"]'));
      let activeSignatureBox = null;
      let signatureBaseImage = null; // snapshot of existing signature when opening modal

      function setupSignatureContext(ctx) {
        ctx.strokeStyle = '#000';
        ctx.lineWidth = SIGNATURE_LINE_WIDTH * CANVAS_SCALE;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.setLineDash([]);
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
      }

      function resizeCanvasToDisplaySize(canvas) {
        const rect = canvas.getBoundingClientRect();
        if (!rect.width || !rect.height) return false;
        
        const displayWidth = Math.round(rect.width * CANVAS_SCALE);
        const displayHeight = Math.round(rect.height * CANVAS_SCALE);
        
        if (canvas.width !== displayWidth || canvas.height !== displayHeight) {
          // Save current content
          const snapshot = document.createElement('canvas');
          snapshot.width = canvas.width;
          snapshot.height = canvas.height;
          const sctx = snapshot.getContext('2d');
          sctx.drawImage(canvas, 0, 0);

          // Resize
          canvas.width = displayWidth;
          canvas.height = displayHeight;

          // Restore content
          const ctx = canvas.getContext('2d');
          // Disable smoothing for restoration to avoid compounding blur
          ctx.imageSmoothingEnabled = false; 
          ctx.drawImage(snapshot, 0, 0, snapshot.width, snapshot.height, 0, 0, canvas.width, canvas.height);
          
          setupSignatureContext(ctx);
          return true;
        }
        return false;
      }

      // Initialize all signature boxes with high resolution
      signatureBoxes.forEach(canvas => {
        resizeCanvasToDisplaySize(canvas);
        setupSignatureContext(canvas.getContext('2d'));
      });

      function openSignatureModalFor(canvas) {
        if (!signatureModal || !signatureModalCanvas) return;
        activeSignatureBox = canvas;
        signatureModal.classList.remove('hidden');

        // Use setTimeout to ensure the modal is fully rendered and has dimensions
        setTimeout(() => {
          resizeCanvasToDisplaySize(signatureModalCanvas);

          const ctx = signatureModalCanvas.getContext('2d');
          setupSignatureContext(ctx);
          
          // Clear and draw the existing signature from the small box
          ctx.clearRect(0, 0, signatureModalCanvas.width, signatureModalCanvas.height);
          if (activeSignatureBox) {
            // Draw the small signature scaled up. It might be blurry because the source is small.
            // We enable smoothing to make it look better than pixelated.
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            ctx.drawImage(
              activeSignatureBox,
              0,
              0,
              activeSignatureBox.width,
              activeSignatureBox.height,
              0,
              0,
              signatureModalCanvas.width,
              signatureModalCanvas.height
            );
          }
          // Snapshot the current (existing) signature so edits don't erase it during redraws
          signatureBaseImage = ctx.getImageData(0, 0, signatureModalCanvas.width, signatureModalCanvas.height);
        }, 50);
      }

      function closeSignatureModal() {
        if (!signatureModal) return;
        signatureModal.classList.add('hidden');
        activeSignatureBox = null;
      }

      // Open modal when clicking any signature box
      signatureBoxes.forEach(canvas => {
        canvas.addEventListener('click', e => {
          e.preventDefault();
          openSignatureModalFor(canvas);
        });
      });

      // Draw inside modal canvas (Pointer Events: mouse + touch)
      if (signatureModalCanvas) {
        const ctx = signatureModalCanvas.getContext('2d');
        let isDrawing = false;
        let points = [];

        function addPoint(pt) {
          if (!points.length) {
            points.push(pt);
            return true;
          }
          const last = points[points.length - 1];
          const dx = pt.x - last.x;
          const dy = pt.y - last.y;
          const dist2 = dx * dx + dy * dy;
          // Ignore ultra-short moves to reduce jitter/dots (increased threshold)
          if (dist2 < 2) return false;
          points.push(pt);
          return true;
        }

        function getPos(e) {
          const rect = signatureModalCanvas.getBoundingClientRect();
          const scaleX = signatureModalCanvas.width / rect.width;
          const scaleY = signatureModalCanvas.height / rect.height;
          return [(e.clientX - rect.left) * scaleX, (e.clientY - rect.top) * scaleY];
        }

        function drawSmoothLine() {
          if (points.length === 0) return;

          setupSignatureContext(ctx);
          ctx.beginPath();
          
          if (points.length < 3) {
            // If we have only one or two points, just draw a line
            const p0 = points[0];
            ctx.moveTo(p0.x, p0.y);
            for (let i = 1; i < points.length; i++) {
              ctx.lineTo(points[i].x, points[i].y);
            }
          } else {
            // Use a more advanced smoothing algorithm for 3+ points
            ctx.moveTo(points[0].x, points[0].y);
            let i;
            for (i = 1; i < points.length - 2; i++) {
              const c = (points[i].x + points[i + 1].x) / 2;
              const d = (points[i].y + points[i + 1].y) / 2;
              ctx.quadraticCurveTo(points[i].x, points[i].y, c, d);
            }
            // For the last 2 points
            ctx.quadraticCurveTo(
              points[i].x,
              points[i].y,
              points[i + 1].x,
              points[i + 1].y
            );
          }
          ctx.stroke();
        }

        signatureModalCanvas.addEventListener('pointerdown', e => {
          e.preventDefault();
          // Ensure canvas size is correct before starting
          const resized = resizeCanvasToDisplaySize(signatureModalCanvas);
          
          // If we resized, we need to re-capture the base image because the old one is invalid/scaled
          // But wait, resizeCanvasToDisplaySize restores the content.
          // So we just need to grab the new state.
          if (resized || !signatureBaseImage) {
             signatureBaseImage = ctx.getImageData(0, 0, signatureModalCanvas.width, signatureModalCanvas.height);
          }

          isDrawing = true;
          points = [];
          signatureModalCanvas.setPointerCapture(e.pointerId);
          
          const [x, y] = getPos(e);
          addPoint({ x, y });

          // Redraw immediately to show the first dot
          ctx.clearRect(0, 0, signatureModalCanvas.width, signatureModalCanvas.height);
          if (signatureBaseImage) {
            ctx.putImageData(signatureBaseImage, 0, 0);
          }
          drawSmoothLine();
        });

        signatureModalCanvas.addEventListener('pointermove', e => {
          if (!isDrawing) return;
          e.preventDefault();

          const events = typeof e.getCoalescedEvents === 'function' ? e.getCoalescedEvents() : [e];
          
          for (const ev of events) {
            const [x, y] = getPos(ev);
            addPoint({ x, y });
          }
          
          // Redraw entire smooth line
          ctx.clearRect(0, 0, signatureModalCanvas.width, signatureModalCanvas.height);
          if (signatureBaseImage) {
            ctx.putImageData(signatureBaseImage, 0, 0);
          }
          drawSmoothLine();
        });

        function stopDrawing() {
          if (isDrawing && points.length > 0) {
            // This final draw ensures the last segment is committed
            ctx.clearRect(0, 0, signatureModalCanvas.width, signatureModalCanvas.height);
            if (signatureBaseImage) {
              ctx.putImageData(signatureBaseImage, 0, 0);
            }
            drawSmoothLine();
          }
          isDrawing = false;
          // After the stroke is done, the "base image" for the *next* stroke
          // becomes the canvas with the stroke we just drew.
          signatureBaseImage = ctx.getImageData(0, 0, signatureModalCanvas.width, signatureModalCanvas.height);
          points = [];
        }

        signatureModalCanvas.addEventListener('pointerup', stopDrawing);
        signatureModalCanvas.addEventListener('pointercancel', stopDrawing);
        signatureModalCanvas.addEventListener('pointerleave', stopDrawing);
      }

      if (signatureCloseBtn) signatureCloseBtn.addEventListener('click', closeSignatureModal);

      if (signatureClearBtn && signatureModalCanvas) {
        signatureClearBtn.addEventListener('click', () => {
          const ctx = signatureModalCanvas.getContext('2d');
          ctx.clearRect(0, 0, signatureModalCanvas.width, signatureModalCanvas.height);
          signatureBaseImage = null;
        });
      }

      if (signatureSaveBtn && signatureModalCanvas) {
        signatureSaveBtn.addEventListener('click', () => {
          if (!activeSignatureBox) return closeSignatureModal();
          
          // Ensure the destination canvas is also set up for high quality
          const destCtx = activeSignatureBox.getContext('2d');
          setupSignatureContext(destCtx);
          
          destCtx.clearRect(0, 0, activeSignatureBox.width, activeSignatureBox.height);
          destCtx.drawImage(
            signatureModalCanvas,
            0,
            0,
            signatureModalCanvas.width,
            signatureModalCanvas.height,
            0,
            0,
            activeSignatureBox.width,
            activeSignatureBox.height
          );
          closeSignatureModal();
        });
      }

      // Delete Signature
      document.querySelectorAll('button').forEach(btn => {
        if (btn.textContent.trim() === 'حذف التوقيع') {
          btn.addEventListener('click', function (e) {
            e.preventDefault();
            const canvas = this.closest('.flex-col').querySelector('canvas');
            if (canvas) canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);
          });
        }
      });

      // PDF Export
      async function exportToPDF() {
        try {
          const el = document.querySelector('.form-container');
          const canvas = await html2canvas(el, { scale: 2, useCORS: true, backgroundColor: '#fff' });
          const imgData = canvas.toDataURL('image/png');
          const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
          const w = 210;
          const h = canvas.height * w / canvas.width;
          let heightLeft = h;
          let position = 0;
          pdf.addImage(imgData, 'PNG', 0, position, w, h);
          heightLeft -= 297;
          while (heightLeft >= 0) {
            position = heightLeft - h;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 0, position, w, h);
            heightLeft -= 297;
          }
          pdf.save('نموذج_فحص_حافلة.pdf');
          showToast('تم التصدير بنجاح!', 'success');
        } catch (e) {
          showToast('خطأ في التصدير.', 'error');
        }
      }

      // Fill Test Data
      function fillTestData() {
        const inputs = document.querySelectorAll('input[type="text"]');
        if (inputs.length >= 5) {
          inputs[0].value = "أ ب ج 1234";
          inputs[1].value = "OPR-2025-001";
          inputs[2].value = "45";
          inputs[3].value = "مدرسة النور";
          inputs[4].value = "125,430";
        }
        const today = new Date().toISOString().split('T')[0];
        document.querySelectorAll('input[type="date"]').forEach(i => i.value = today);
        document.querySelectorAll('input[type="checkbox"]').forEach((cb, i) => cb.checked = i % 2 === 0 && Math.random() > 0.3);
        document.querySelectorAll('textarea').forEach(ta => ta.value = "ملاحظات تجريبية...");
        const nameInputs = document.querySelectorAll('input[placeholder*="الاسم"]');
        if (nameInputs.length >= 3) {
          nameInputs[0].value = "أحمد علي";
          nameInputs[1].value = "خالد سعيد";
          nameInputs[2].value = "فهد محمد";
        }
        document.querySelectorAll('table').forEach(updateTableStatus);
        showToast('تم تعبئة البيانات!', 'success');
      }

      // Clear Form
      function clearForm() {
        if (!confirm('مسح كل البيانات؟')) return;
        document.querySelectorAll('input, textarea, select').forEach(el => {
          if (el.type === 'checkbox') el.checked = false;
          else if (el.tagName === 'SELECT') el.selectedIndex = 0;
          else el.value = '';
        });
        document.querySelectorAll('canvas').forEach(c => c.getContext('2d').clearRect(0, 0, c.width, c.height));
        document.querySelectorAll('.percent-badge').forEach(b => { b.value = '0%'; b.style.color = '#dc2626'; });
        damageMarkers = []; renderPrintMarkers(); 
        document.querySelectorAll('table').forEach(updateTableStatus);
        showToast('تم المسح!', 'info');
      }

      // Smart Form Logic
      const PASS_OPTIONS = [
        'ممتازة', 'جيدة', 'سليمة', 'جديدة', 'بحالة جيدة', 
        'موجودة وتعمل', 'يعمل بكفاءة', 'مكتملة وسارية', 
        'موجودة وواضحة', 'نظيفة وسليمة', 'مكتملة وسليمة', 
        'يعمل', 'ملتزم تماماً', 'ملتزم غالباً', 
        'لائق ومطابق للتعليمات', 'ممتاز', 'جيد', 'ملتزم', 
        'مواظب', 'مواظب غالباً', 'يبلغ ويتابع', 'سليم',
        'مقبولة', 'ملاحظة بسيطة', 'خدوش بسيطة', 'شرخ بسيط',
        'يعمل جزئياً', 'مكتملة وقريبة الانتهاء', 'موجودة وباهتة',
        'فعالة جزئياً', 'مكتملة مع ملاحظات', 'يعمل أحياناً',
        'تأخير بسيط', 'مقبول', 'ملتزم مع ملاحظات', 'يبلغ فقط',
        'متوسطة', 'تحتاج تنظيف', 'يحتاج تنبيه'
      ];

      const PERFECT_OPTIONS = [
        'ممتازة', 'سليمة', 'جديدة', 'موجودة وتعمل', 'يعمل بكفاءة', 
        'مكتملة وسارية', 'موجودة وواضحة', 'نظيفة وسليمة', 'مكتملة وسليمة', 
        'يعمل', 'ملتزم تماماً', 'لائق ومطابق للتعليمات', 'ممتاز', 
        'ملتزم', 'مواظب', 'يبلغ ويتابع', 'سليم'
      ];

      // Custom Toast Function
      function showToast(message, type = 'info') {
        let toast = document.getElementById('toast-notification');
        if (!toast) {
          toast = document.createElement('div');
          toast.id = 'toast-notification';
          toast.className = 'toast-notification';
          document.body.appendChild(toast);
        }
        
        // Reset classes
        toast.className = 'toast-notification';
        // Force reflow
        void toast.offsetWidth;
        
        toast.textContent = message;
        toast.classList.add(type);
        toast.classList.add('show');

        // Clear previous timeout if exists
        if (toast.timeoutId) clearTimeout(toast.timeoutId);

        toast.timeoutId = setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      }

      function initSmartForm() {
        const desktopRows = Array.from(document.querySelectorAll('table tbody tr')).filter(row => !row.querySelector('.percent-badge'));
        const mobileCards = Array.from(document.querySelectorAll('.lg\\:hidden .p-4.flex.flex-col.gap-3'));

        const count = Math.max(desktopRows.length, mobileCards.length);

        for (let i = 0; i < count; i++) {
           setupSmartPair(desktopRows[i], mobileCards[i]);
        }
      }

      function setupSmartPair(row, card) {
         const getInputs = (container) => {
            if (!container) return null;
            const checkboxes = container.querySelectorAll('input[type="checkbox"]');
            const select = container.querySelector('select');
            // Ensure we have at least 2 checkboxes for pass/fail
            if (checkboxes.length < 2) return null;
            return { 
               pass: checkboxes[0], 
               fail: checkboxes[1], 
               select: select,
               container: container
            };
         };

         const d = getInputs(row);
         const m = getInputs(card);

         let itemName = "بند";
         if (row && row.cells) itemName = row.cells[0].innerText.trim();
         else if (card) {
            const t = card.querySelector('.font-medium');
            if (t) itemName = t.innerText.trim();
         }

         const syncAndTrigger = (finalPass, finalFail, finalSelect) => {
            // Sync Desktop
            if (d) {
               d.pass.checked = finalPass;
               d.fail.checked = finalFail;
               if (d.select && finalSelect !== undefined) d.select.value = finalSelect;
               triggerUpdate(d.container);
            }
            // Sync Mobile
            if (m) {
               m.pass.checked = finalPass;
               m.fail.checked = finalFail;
               if (m.select && finalSelect !== undefined) m.select.value = finalSelect;
               triggerUpdate(m.container);
            }
         };

         // Desktop Listeners
         if (d) {
            d.pass.addEventListener('change', () => {
               if (d.pass.checked) d.fail.checked = false;
               syncAndTrigger(d.pass.checked, d.fail.checked, d.select ? d.select.value : undefined);
            });
            d.fail.addEventListener('change', () => {
               if (d.fail.checked) {
                  d.pass.checked = false;
                  showToast(`تنبيه: تم تسجيل فشل في بند "${itemName}"`, 'error');
               }
               syncAndTrigger(d.pass.checked, d.fail.checked, d.select ? d.select.value : undefined);
            });
            if (d.select) {
               d.select.addEventListener('change', () => {
                  const val = d.select.value;
                  let p = d.pass.checked;
                  let f = d.fail.checked;
                  if (val) {
                     if (PASS_OPTIONS.includes(val)) { p = true; f = false; }
                     else { f = true; p = false; showToast(`تنبيه: تم تسجيل فشل في بند "${itemName}" بسبب التقييم "${val}"`, 'error'); }
                  }
                  syncAndTrigger(p, f, val);
               });
            }
         }

         // Mobile Listeners
         if (m) {
            m.pass.addEventListener('change', () => {
               if (m.pass.checked) m.fail.checked = false;
               syncAndTrigger(m.pass.checked, m.fail.checked, m.select ? m.select.value : undefined);
            });
            m.fail.addEventListener('change', () => {
               if (m.fail.checked) {
                  m.pass.checked = false;
                  showToast(`تنبيه: تم تسجيل فشل في بند "${itemName}"`, 'error');
               }
               syncAndTrigger(m.pass.checked, m.fail.checked, m.select ? m.select.value : undefined);
            });
            if (m.select) {
               m.select.addEventListener('change', () => {
                  const val = m.select.value;
                  let p = m.pass.checked;
                  let f = m.fail.checked;
                  if (val) {
                     if (PASS_OPTIONS.includes(val)) { p = true; f = false; }
                     else { f = true; p = false; showToast(`تنبيه: تم تسجيل فشل في بند "${itemName}" بسبب التقييم "${val}"`, 'error'); }
                  }
                  syncAndTrigger(p, f, val);
               });
            }
         }
      }

      function triggerUpdate(element) {
        // If element is in a table, update that table
        const table = element.closest('table');
        if (table) {
          updateTableStatus(table);
        } else {
          // If mobile, we just update the global progress bar
          updateProgressBar();
        }
      }

      function updateTableStatus(table) {
        const rows = Array.from(table.querySelectorAll('tbody tr'));
        let totalItems = 0;
        let answeredCount = 0;
        let passedCount = 0;
        let issues = [];

        rows.forEach(row => {
          if (row.querySelector('.percent-badge')) return;
          
          const checkboxes = row.querySelectorAll('input[type="checkbox"]');
          if (checkboxes.length < 2) return;

          const passCb = checkboxes[0];
          const failCb = checkboxes[1];
          const select = row.querySelector('select');
          const itemName = row.cells[0].innerText.trim();

          totalItems++;
          
          if (passCb.checked) {
            passedCount++;
            answeredCount++;
            // Check if we need to add a note even if passed
            if (select && select.value && !PERFECT_OPTIONS.includes(select.value)) {
               issues.push(`- ${itemName}: ${select.value}`);
            }
          } else if (failCb.checked) {
            answeredCount++;
            const reason = select && select.value ? select.value : 'فشل';
            issues.push(`- ${itemName}: ${reason}`);
          }
        });

        // Calculate Percentage based on ANSWERED items (Relative Score)
        // This ensures the score reflects the current evaluation state directly.
        const pct = answeredCount === 0 ? 0 : Math.round((passedCount / answeredCount) * 100);
        
        const badge = table.querySelector('.percent-badge');
        if (badge) {
          badge.value = pct + '%';
          badge.style.color = pct >= 80 ? '#16a34a' : pct >= 50 ? '#f59e0b' : '#dc2626';
        }

        // Smart Notes
        const textarea = table.querySelector('textarea');
        if (textarea) {
          if (issues.length > 0) {
            textarea.value = "الملاحظات:\n" + issues.join("\n");
          } else if (passedCount === totalItems && totalItems > 0) {
            textarea.value = "جميع البنود سليمة.";
          } else {
            textarea.value = "";
          }
        }
        
        updateProgressBar();
      }

      function updateProgressBar() {
        const pass = Array.from(document.querySelectorAll('input[type="checkbox"]')).filter((_,i)=>i%2===0);
        const done = pass.filter(cb=>cb.checked).length;
        const total = pass.length;
        const pct = total ? Math.round((done/total)*100) : 0;
        const bar = document.querySelector('.bg-blue-400');
        const text = document.querySelector('.text-blue-600 + span');
        if (bar) bar.style.width = pct + '%';
        if (text) text.textContent = pct + '%';
      }

      // Damage Markers
      let damageMarkers = [];

      const inlineDiagramImgs = Array.from(document.querySelectorAll('img[alt="Diagram"]'));
      const diagramWrappers = (() => {
        const seen = new Set();
        const wrappers = [];
        inlineDiagramImgs.forEach(img => {
          const wrapper = img.closest('.relative');
          if (!wrapper) return;
          if (seen.has(wrapper)) return;
          seen.add(wrapper);
          wrappers.push(wrapper);
        });
        return wrappers;
      })();

      function renderModalMarkers() {
        if (!diagramContainer) return;
        diagramContainer.querySelectorAll('.damage-marker').forEach(el => el.remove());
        damageMarkers.forEach(m => {
          const el = document.createElement('div');
          el.className = 'damage-marker absolute cursor-pointer z-10 select-none';
          el.style.left = m.x + '%';
          el.style.top = m.y + '%';
          el.style.transform = 'translate(-50%,-50%)';
          el.style.fontSize = '18px';
          el.style.lineHeight = '1';
          el.textContent = '❌';
          el.addEventListener('click', ev => {
            ev.stopPropagation();
            damageMarkers = damageMarkers.filter(mm => !(mm.x === m.x && mm.y === m.y));
            el.remove();
            renderPrintMarkers();
          });
          diagramContainer.appendChild(el);
        });
      }

      function openDiagramModal(src) {
        if (!modal || !modalImg) return;
        modalImg.src = src;
        renderModalMarkers();
        modal.classList.remove('hidden');
      }

      inlineDiagramImgs.forEach(img => {
        img.addEventListener('click', () => openDiagramModal(img.src));
      });

      if (diagramContainer && modalImg) {
        diagramContainer.addEventListener('click', e => {
          if (e.target === modalImg) {
            const rect = modalImg.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;
            const xPct = parseFloat(x.toFixed(2));
            const yPct = parseFloat(y.toFixed(2));
            damageMarkers.push({ x: xPct, y: yPct });
            const el = document.createElement('div');
            el.className = 'damage-marker absolute cursor-pointer z-10 select-none';
            el.style.left = xPct + '%';
            el.style.top = yPct + '%';
            el.style.transform = 'translate(-50%,-50%)';
            el.style.fontSize = '18px';
            el.style.lineHeight = '1';
            el.textContent = '❌';
            el.addEventListener('click', ev => {
              ev.stopPropagation();
              damageMarkers = damageMarkers.filter(m => !(m.x === xPct && m.y === yPct));
              el.remove();
              renderPrintMarkers();
            });
            diagramContainer.appendChild(el);
            renderPrintMarkers();
          }
        });
      }

      if (closeModalBtn && modal) {
        closeModalBtn.addEventListener('click', () => {
          modal.classList.add('hidden');
          renderPrintMarkers();
        });
      }

      function renderPrintMarkers() {
        if (!diagramWrappers.length) return;
        diagramWrappers.forEach(wrapper => {
          wrapper.querySelectorAll('.damage-marker-print').forEach(el => el.remove());
          damageMarkers.forEach(m => {
            const el = document.createElement('div');
            // مرئية على المخطط داخل الصفحة + ستظهر أيضاً عند الطباعة
            el.className = 'damage-marker-print absolute pointer-events-none select-none';
            el.style.left = m.x + '%';
            el.style.top = m.y + '%';
            el.style.transform = 'translate(-50%,-50%)';
            el.style.zIndex = '10';
            el.textContent = '❌';
            wrapper.appendChild(el);
          });
        });
      }

      // Init Smart Form
      initSmartForm();

      // Init
      const today = new Date().toISOString().split('T')[0];
      document.querySelectorAll('input[type="date"]:not([value])').forEach(i => i.value = today);
      document.querySelectorAll('table').forEach(updateTableStatus);
      renderPrintMarkers();
    });
  </script>
</body>
</html>
